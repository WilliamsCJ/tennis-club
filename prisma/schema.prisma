generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = "file:./tennis-club.sqlite"
}

model courts {
  venue        String
  court_number Int
  surface      String
  notes        String?
  venues       venues    @relation(fields: [venue], references: [name])
  matches      matches[]

  @@id([court_number, venue])
}

model matches {
  id                                Int      @id @default(autoincrement())
  p1_email                          String?
  p2_email                          String?
  date_played                       DateTime
  court_number                      Int
  venue_name                        String
  courts                            courts   @relation(fields: [court_number, venue_name], references: [court_number, venue], onUpdate: Restrict)
  players_matches_p1_emailToplayers players? @relation("matches_p1_emailToplayers", fields: [p1_email], references: [email])
  players_matches_p2_emailToplayers players? @relation("matches_p2_emailToplayers", fields: [p2_email], references: [email])
  sets                              sets[]
}

model players {
  email                             String          @id
  forename                          String
  middlenames                       String?
  surname                           String
  date_of_birth                     DateTime
  elo                               Int             @default(1000)
  notes                             String?
  matches_matches_p1_emailToplayers matches[]       @relation("matches_p1_emailToplayers")
  matches_matches_p2_emailToplayers matches[]       @relation("matches_p2_emailToplayers")
  player_phones                     player_phones[]
}

model sets {
  match_id     Int
  set_number   Int
  p1_games_won Int
  p2_games_won Int
  matches      matches @relation(fields: [match_id], references: [id], onUpdate: Restrict)

  @@id([match_id, set_number])
}

model venues {
  name    String   @id
  address String
  courts  courts[]
}

model player_phones {
  email        String
  phone_number String
  phone_type   String
  players      players @relation(fields: [email], references: [email], onDelete: Cascade)

  @@id([email, phone_number])
}

model rankings {
  fullname  String @unique
  elo       Int
  wins      Int
}